<html>

<head>
    <title></title>
    <style type="text/css">
        * {
            padding: 0;
            margin: 0;
            box-sizing: border-box;
            outline: 0;
            border: 0;
            list-style-type: none;
        }

        form label {
            font-size: 1.4rem;
            color: #7a869a;
            font-weight: 400;
            z-index: 2;
            transition: 0.2s ease all;
            display: block;
            padding-bottom: 6px;
            text-align: left;
        }

        form textarea {
            width: 100%;
            height: 284px;
            resize: none;
            border: 1px solid #7a869a;
        }

        .modal-body {
            min-height: 600px;
        }

        #campos {
            min-height: 556px;
        }

        #formulario {
            min-height: 534px;
        }

        .header-label {
            position: relative;
            top: -2px;
            font-size: 1.2rem;
        }

        .borda-cabecalho {
            border-right: 1px solid #dfe1e5;
        }

        .alinhaTexto {
            position: relative;
            top: -12px;
            left: -10px;
        }

        .linhaSeparadoraCabecalho {
            border-top: 1px solid #e6eaee;
            display: flex;
            padding: 15px;
            margin-left: 0;
            margin-right: 0;
        }

        #txtNomeCompleto {
            font-size: 2.2rem;
            font-weight: 600;
            display: block;
            padding-left: 0px;
        }

        #txtNomeCompleto,
        #txtCpf,
        #txtTelefone,
        #txtEmail {
            border: none;
            background: none;
        }

        #informacoesCadastrais {
            margin-top: 2vh;
        }

        .lblDocumentos {
            text-align: center;
        }

        .linkDocumentos {
            border: 1px solid #7a869a;
        }

        #h3TermoResponsabilidade {
            color: #7a869a;
            text-align: center;
            font-size: 20px;
            font-weight: 400;
            display: block;
        }

        #pTermoResponsabilidade {
            color: #7a869a;
            text-indent: 1.5em;
            text-align: justify;
            text-justify: inter-word;
            font-weight: 400;
            font-size: 16px;
            letter-spacing: 0.02em;
            margin-bottom: 0;
            z-index: 2;
            transition: 0.2s ease all;
            display: block;
            padding-bottom: 6px;
        }

        .espaco-topo {
            margin-top: 20px;
        }

        @media screen and (max-width: 991px) {
            .alinhaTexto {
                position: relative;
                top: -12px;
                left: -12px;
            }

            #txtLocalPesca {
                width: 52.5vw;
            }
        }
    </style>
    <link href="chrome-extension://nffaoalbilbmmfgbnbgppjihopabppdk/inject.css" rel="stylesheet" type="text/css" />
</head>

<body class="vsc-initialized">
    <section>
        <div class="content" id="idContent"><button aria-hidden="true" class="close" data-dismiss="modal"
                type="button"></button>
            <div id="cabecalho">
                <div class="row">
                    <div class="col-md-12">
                        <div class="col-md-12"><input class="form-control" data-campo-id="@@2@@"
                                data-nome="Nome completo" id="txtNomeCompleto" type="text" value="" /></div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-3 borda-cabecalho"><label
                            class="col-md-3 control-label header-label">CPF/CNPJ</label>

                        <div class="col-md-9"><input class="form-control alinhaTexto" data-campo-id="@@1@@"
                                data-nome="CPF/CNPJ" id="txtCpf" size="14" type="text" value="" /></div>
                    </div>

                    <div class="col-md-3 borda-cabecalho"><label class="col-md-3 control-label header-label">Telefone
                            para Contato</label>

                        <div class="col-md-9"><input class="form-control alinhaTexto" data-campo-id="@@20@@"
                                data-nome="Telefone" id="txtTelefone" maxlength="15" type="text" value="" /></div>
                    </div>

                    <div class="col-md-6"><label class="col-md-2 control-label header-label">E-mail</label>

                        <div class="col-md-10"><input class="form-control alinhaTexto" data-campo-id="@@21@@"
                                data-nome="E-mail" id="txtEmail" size="14" type="text" value="" /></div>
                    </div>
                </div>
            </div>

            <div class="row tabbable tabbable-tabdrop linhaSeparadoraCabecalho" id="informacoesCadastrais">
                <div class="form-group">
                    <nav id="navegacao">
                        <ul class="nav nav-pills">
                            <li class="dropdown tabdrop active"><a class="tab-item" data-toggle="tab" href="#"
                                id="tab-item-identificacaoPescador"
                                idform="#identificacaoPescador">Identifica&ccedil;&atilde;o do Pescador</a>
                            </li>
                            <li class="dropdown tabdrop"><a class="tab-item" data-toggle="tab" href="#"
                                id="tab-item-recurso" idform="#formRecurso">Recurso</a>
                            </li>
                            <li class="dropdown tabdrop"><a class="tab-item" data-toggle="tab" href="#"
                                id="tab-item-analise-recurso" idform="#formAnalise">Análise do Recurso</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>

            <div class="row form-inputs" id="identificacaoPescador">
                <div class="col-md-12">
                    <div class="col-xs-12 col-sm-12 col-md-4">
                        <div class="form-group"><label class="control-label">Tipo Registro</label> <select
                                class="form-control" data-campo-id="@@95@@"></select></div>
                    </div>

                    <div class="col-xs-12 col-sm-12 col-md-4">
                        <div class="form-group"><label class="control-label">Sexo</label> <select class="form-control"
                                data-campo-id="@@10@@"></select></div>
                    </div>

                    <div class="col-xs-12 col-sm-12 col-md-4">
                        <div class="form-group"><label class="control-label">Data Nascimento</label> <input
                                class="form-control date-picker" data-campo-id="@@9@@" id="" type="text" value="" />
                        </div>
                    </div>

                    <div class="col-xs-12 col-sm-12 col-md-4">
                        <div class="form-group"><label class="control-label">Nome M&atilde;e</label> <input
                                class="form-control" data-campo-id="@@12@@" type="text" /></div>
                    </div>

                    <div class="col-xs-12 col-sm-12 col-md-4">
                        <div class="form-group"><label class="control-label"> Categoria</label> <select
                                class="form-control" data-campo-id="@@22@@"></select></div>
                    </div>

                    <div class="col-xs-12 col-sm-12 col-md-4">
                        <div class="form-group"><label class="control-label"> Forma de Atua&ccedil;&atilde;o</label>
                            <select class="form-control" data-campo-id="@@23@@"></select>
                        </div>
                    </div>

                    <div class="col-xs-12 col-sm-12 col-md-4">
                        <div class="form-group"><label class="control-label">N&ordm; RGP
                                Embarca&ccedil;&atilde;o</label> <input class="form-control" data-campo-id="@@25@@"
                                data-nome="Nº RGP Embarcação" id="txtNumeroRGP" placeholder="Nº RGP Embarcação" /></div>
                    </div>

                    <div class="col-md-12" style="display: none"><span class="h-card" data-campo-altura="10"
                            data-campo-classe="" data-campo-estilo="" data-campo-largura="200"
                            style="display: block"><span class="form-md-line-input"><input class="form-control"
                                    data-campo-id="@@94@@" id="@@94@@" placeholder="94 - IdUsuarioPescador"
                                    style="width: 200px" type="text" /></span></span></div>
                </div>
            </div>

            <div class="form-inputs" id="formRecurso" style="display: none; padding-left: 40px;">
                <div class="row">
                    <div>
                        <div class="mt-radio-list" data-campo-id="@@149@@" id="CAMPO_149"
                            style="display: flex;"><label class="mt-radio"><input
                                    data-nome="149 - Suspensao ou Cancelamento Radio" data-valor=""
                                    name="149 - Suspensao ou Cancelamento Radio" type="radio" /><label
                                    data-texto=""></label><span></span></label></div>
                    </div>

                    <div class="row">
                        <div class="col-sm-12 col-md-7 form-group" style="display: none;"><label
                                for="CAMPO_147">Motivo de Cancelamento</label><select
                                class="form-control date-picker" data-campo-id="@@147@@"
                                data-nome="147 - Motivo Cancelamento" data-tipo-documental-id="2"
                                id="CAMPO_147"></select></div>

                        <div class="col-sm-12 col-md-7 form-group" style="display: none;"><label
                                for="CAMPO_148">Motivo de Suspens&atilde;o</label><select
                                class="form-control date-picker" data-campo-id="@@148@@"
                                data-nome="148 - Motivos de Suspensão" data-tipo-documental-id="2"
                                id="CAMPO_148"></select></div>
                    </div>

                    <div class="row">
                        <div class="col-sm-12 col-md-7">
                            <div class="form-group"><label
                                    class="control-label">Justificativa</label><textarea
                                    class="form-control input-sm campoNome validaCaracteres"
                                    data-campo-id="@@150@@" data-nome="150 - Justificativa Cancelamento ADM"
                                    id="txtJustificativaCancelamento"
                                    pattern="[a-zA-Z0-9áàâãéèêíïóôõöúçñÁÀÂÃÉÈÊÍÏÓÔÕÖÚÇÑ\s]+"
                                    placeholder="Informe o motivo pelo qual deseja cancelar/suspender esse registro"
                                    rows="5"></textarea></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-12 col-md-7">
                            <div class="form-group">
                                <label class="control-label">Apresentação de Recurso</label>
                                <textarea
                                    class="form-control input-sm campoNome validaCaracteres"
                                    data-campo-id="@@164@@" data-nome="164 - Recurso de Cancelamento"
                                    id="txtAnaliseRecurso"
                                    pattern="[a-zA-Z0-9áàâãéèêíïóôõöúçñÁÀÂÃÉÈÊÍÏÓÔÕÖÚÇÑ\s]+"
                                    rows="5" required>
                                </textarea>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12 col-md-6">
                            <div class="form-group" id="divDocumentoAdicional2"><label
                                    class="control-label">Documento Adicional</label> <i
                                    class="fa fa-check font-green-jungle fa-2x" style="display: none"
                                    title="Documento enviado!"></i> <input accept="image/png, image/jpeg, image/jpg"
                                    class="formulario-upload fa upload-file" data-arquivo-nome=""
                                    data-nome="Recurso Cancelamento" data-placement="bottom" data-tipo-anexo-id="67"
                                    data-toggle="tooltip" id="uploadDocumentoAdicional" max-size-mb="5"
                                    title="Anexo de documento que complementa o recurso apresentado."
                                    type="file" />
                                <h6 class="help-block">Com foco n&iacute;tido e limpo</h6>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-inputs" id="formAnalise" style="display: none; padding-left: 40px;">
                <div class="row">
                    <div class="col-sm-12 col-md-6">
                        <div class="form-group">
                            <label class="control-label">Parecer da Análise</label>
                            <textarea
                                class="form-control input-sm campoNome validaCaracteres"
                                data-campo-id="@@165@@" data-nome="165 - Analise do recurso"
                                id="txtParecerAnalise"
                                pattern="[a-zA-Z0-9áàâãéèêíïóôõöúçñÁÀÂÃÉÈÊÍÏÓÔÕÖÚÇÑ\s]+"
                                rows="5" required>
                            </textarea>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-12 col-md-6">
                        <div class="form-group" id="divDocumentoAdicional2"><label
                                class="control-label">Documento Adicional</label> <i
                                class="fa fa-check font-green-jungle fa-2x" style="display: none"
                                title="Documento enviado!"></i> <input accept="image/png, image/jpeg, image/jpg"
                                class="formulario-upload fa upload-file" data-arquivo-nome=""
                                data-nome="documentoAdicionalAnaliseRecurso" data-placement="bottom" data-tipo-anexo-id="70"
                                data-toggle="tooltip" id="uploadDocumentoAdicional" max-size-mb="5"
                                title="Anexo de documento que complementa o parecer da análise."
                                type="file" />
                            <h6 class="help-block">Com foco n&iacute;tido e limpo</h6>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <script>
        Ecm.bloquearElemento('.modal-body');
        DocumentoVisualizacaoForm.camposCarregados(function () {
            var listaAnexoId = [];
            var valido;
            var ultimoAnexoIdTemporario = 0;
            var ultimoTipoAnexoIdTemporario = 0;
            var listaAnexos = DocumentoVisualizacaoForm.retornaListaAnexosDocumento();
            var elementoLinkInseridos = '';
            var elementoDocumentoDeclaracao = '';
            var documentoId = parseInt(DocumentoVisualizacaoForm.retornaDocumento().id);
            var docVersaoId = parseInt(DocumentoVisualizacaoForm.versaoId());
            var usuarioId = parseInt(Ecm.retornaUsuario().id);

            $('#versoes').remove();

            validaBotoes(68, false);
            validaBotoes(33, false);
            
            $('#CAMPO_149 label').each((i, e) => {
                $(e).css('marginRight', '15px');
            })

            
            Ecm.registraEvento('change', '#CAMPO_149', event => {
                $('#CAMPO_149 label.mt-radio').each((i, e) => {
                    if (!$(e).children()[0].checked) {
                        $('#CAMPO_148').closest('div').hide('fast');
                        $('#CAMPO_147').closest('div').show('fast');
                        $('#CAMPO_147').attr('required', 'required');
                        $('#CAMPO_148').removeAttr('required');
                    }
                    if ($(e).children()[0].checked) {
                        $('#CAMPO_147').closest('div').hide('fast');
                        $('#CAMPO_148').closest('div').show('fast');
                        $('#CAMPO_148').attr('required', 'required');
                        $('#CAMPO_147').removeAttr('required');
                    }

                })
            })

            $('#CAMPO_149').trigger('change');

            var estouEditando = DocumentoVisualizacaoForm.estouEditando();

            if(estouEditando) {
                const campos = DocumentoVisualizacaoForm.retornaCampos();
                const userGroup = Ecm.retornaUsuario().gruposId.split(','); 

                $.each(campos, (index, element) => { $(`[data-campo-id="@@${element.id}@@"]`).prop('disabled', true) });
                $('#radioObjetivo input').prop('disabled', true);
                $('#txtParecerAnalise').prop('disabled', false).prop('readonly', false);

                $('#idContent').find('input:file').attr('disabled', false);
                $('#lbtDeclaracao').attr('disabled', false);


                validaBotoes(20, false);
                validaBotoes(21, false);

                $('[data-tipo-anexo-id="67"]').prop('disabled', true);

                Ecm.registraEvento('keyup', '#txtParecerAnalise', function() {
                    $.each(userGroup, function(index, element) {
                        if(($('#txtParecerAnalise').val() != '')) {
                            validaBotoes(21, true);
                            validaBotoes(20, true);
                        } else {
                            validaBotoes(20, false);
                            validaBotoes(21, false);
                        }
                    })
                })

                Ecm.registraEvento('change', '#formAnalise', function() {
                    $.each(userGroup, function(index, element) {
                        if(($('#txtParecerAnalise').val() != '')) {
                            validaBotoes(21, true);
                            validaBotoes(20, true);
                        } else {
                            validaBotoes(20, false);
                            validaBotoes(21, false);
                        }
                    })
                })
            } else {
                $('#idContent').find('input:file').attr('disabled', true);
            }


            function verificarAnexoInserido(tipo_Anexo_Id) {
                switch (tipo_Anexo_Id) {
                    case 1:
                        return 'Anexo Padrão';
                    case 2:
                        return 'CPF';
                    case 3:
                        return 'Documento de identificação oficial com foto e CPF (RG, CNH)';
                    case 4:
                        return 'Comprovante de residência';
                    case 6:
                        return 'PIS/PASEP/NIT/NIS';
                    case 7:
                        return 'Carteira de Trabalho CTPS (Profissional Industrial)';
                    case 8:
                        return 'Passaporte (Profissional Estrangeiro)';
                    case 9:
                        return 'Autorização de Trabalho (Profissional Estrangeiro)';
                    case 24:
                        return 'Declaração de Filiado ou Não Filiado';
                    case 25:
                        return 'Autorização responsável legal aprendiz';
                    case 26:
                        return 'Autorização judicial do aprendiz';
                    case 27:
                        return 'Anexo Informações adicionais';
                    case 26:
                        return 'Protocolo';
                    case 5:
                        return 'Foto';
                    case 36:
                        return 'Protocolo';
                    case 37:
                        return 'Título de Eleitor';
                    case 56:
                        return 'Declaração de Responsabilidade';
                    case 70:
                        return 'Documento Adicional - Análise de Recurso';
                    default:
                        return 'Tipo anexo não identificado';
                }
            }

            DocumentoVisualizacaoForm.onUploadAnexo(
                function (anexoId) {
                    console.log(anexoId);
                    let lastTempTypeAnnexId = anexoId;

                    if (lastTempTypeAnnexId != '') {
                        lastTempTypeAnnexId = parseInt(lastTempTypeAnnexId);
                    }

                    var $inputUploadAnexo = $('[data-nome="documentoAdicionalAnaliseRecurso"]');

                    console.log($inputUploadAnexo);

                    $inputUploadAnexo.hide();
                    $inputUploadAnexo.siblings('.help-block').hide();
                    $inputUploadAnexo.siblings('.fa-check').show();
                    $inputUploadAnexo.closest('.form-group').removeClass('has-error');
                },
                function () { }
            );

            function retornaDataCampoId(tipo_Anexo_Id) {
                var retornoDataCampoId;

                switch (tipo_Anexo_Id) {
                    case 1:
                        return '@@120@@';
                    case 2:
                        return '@@105@@';
                    case 3:
                        return '@@106@@';
                    case 4:
                        return '@@107@@';
                    case 6:
                        return '@@108@@';
                    case 7:
                        return '@@109@@';
                    case 8:
                        return '@@110@@';
                    case 9:
                        return '@@111@@';
                    case 24:
                        return '@@112@@';
                    case 25:
                        return '@@113@@';
                    case 26:
                        return '@@114@@';
                    case 27:
                        return '@@115@@';
                    case 26:
                        return '@@116@@';
                    case 5:
                        return '@@117@@';
                    case 37:
                        return '@@118@@';
                }
            }

            $.each(listaAnexos, function (i, val) {
                $('#listGroupDocumentosInseridos').show();
                if (val.anexoTipoId != '1' && val.anexoTipoId != '36' && val.anexoTipoId != '56') {
                    elementoLinkInseridos =
                        '<li class="list-group-item">' +
                        '<div class="row">' +
                        '<div class="col-md-12">' +
                        '<div class="form-group">' +
                        '<a class="btn btn-link thumb linkDocumentos" anexoId="' +
                        val.id +
                        '" tipoAnexoId="' +
                        val.anexoTipoId +
                        '" >' +
                        verificarAnexoInserido(val.anexoTipoId) +
                        '</a>' +
                        '</div>' +
                        '</div>' +
                        '</div>' +
                        '</li>';
                    $('#ulDocumentosInseridos').append(elementoLinkInseridos);
                }
                
                if (val.anexoTipoId == '56') {
                    $('#listDocumentoDeclaracao').show();
                    elementoDocumentoDeclaracao =
                        "<li class='list-group-item row'>" +
                        "<a href='#' class='btn btn-link thumb' anexoId='" +
                        val.id +
                        "'" +
                        "tipoAnexoId='" +
                        val.anexoTipoId +
                        "' >" +
                        verificarAnexoInserido(val.anexoTipoId) +
                        '' +
                        "</a><button anexoId='" +
                        val.id +
                        "' tipoAnexoId='" +
                        val.anexoTipoId +
                        "'" +
                        "class='btn btn-danger btn-remover btn-xs'>Remover</button></li>";
                    $('#ulDocumentoDeclaracao').append(elementoDocumentoDeclaracao);

                    var $inputUploadAnexo = $('#div-uploadArquivos [data-tipo-anexo-id=' + val.anexoTipoId + ']');
                    $inputUploadAnexo.hide();
                    $inputUploadAnexo.siblings('p').hide();
                    $inputUploadAnexo.siblings('.fa-check').show();
                }
            });

            if ($('#QtdVezesIndeferido').val() == "") {
                $('#QtdVezesIndeferido').val("0")
            }

            let campos = DocumentoVisualizacaoForm.retornaCampos();
            $.each(campos, (index, element) => {
                $(element).attr('disabled', true);
            })

            if (Ecm.retornaUsuario().gruposId.split(',').includes('171')) {
                $('.cancelar').trigger('click');
                let campos = DocumentoVisualizacaoForm.retornaCampos();
                $.each(campos, (index, element) => {
                    $(element).attr('disabled', 'disabled');
                })
                $('.editar').remove();
                $('.js-exibirModalCarteirinha').show();
            }

            $('#divJus').hide();
            $('#transicao-id-9').prop('disabled', true);
            $('#transicao-id-9').attr('disabled', 'disabled').attr('readonly', 'readonly');
            $('#transicao-id-9').attr('title', 'Existem Pendências');
            $('#transicao-id-58').prop('disabled', true);
            $('#transicao-id-58').attr('disabled', 'disabled').attr('readonly', 'readonly');
            $('#transicao-id-58').attr('title', 'Existem Pendências');

            $('#justificativa').removeAttr('required');
            $('#lbtDeclaracao').attr('disabled', true);

            var anexoDeclaracao = _.filter(listaAnexos, { anexoTipoId: 56 });

            $('#campo28').children().each((i, e) => {
                if ($(e).index() == 4) {
                    $(e).attr('id', 'areapescachk')
                    $('#areapescachk').append('<div id="areaContainer" class="form-group row">');

                    let div = '';
                    div += `<input class="form-control input-sm col-sm-3" id="campoEspecifique" placeholder="Outros" disabled />`

                    $('#areaContainer').append(div)

                }
            })

            $('#campoEspecifique').val($('#especifiqueLabel').val())

            validardocumentosAprovados();

            $('#navegacao ').click(function (e) {
                $('.form-inputs').hide();
                $(e.srcElement.attributes.idform.value).show();
            });

            Ecm.registraEvento('click', '#lbtDeclaracao', function (element) {
                retornarDeclaracao();
            });

            Ecm.registraEvento('click', '.thumb', function (elemento) {
                $('#frameVisualizacao1').attr('src', '');

                var anexoId = $($(elemento)[0].target).attr('anexoId');
                var tipoAnexoId = $($(elemento)[0].target).attr('tipoAnexoId');

                Ecm.bloquearElemento('#frameVisualizacao1');

                retornarAnexo(anexoId, function (retorno) {
                    $('#frameVisualizacao1').attr('src', retorno.imageUrl);
                    Ecm.desbloquearElemento('#frameVisualizacao1');
                });
            });

            Ecm.registraEvento('change', '.documento-aprovado', function (elemento) {
                validardocumentosAprovados();
            });

            Ecm.registraEvento('change', '.upload-file', function (elemento) {
                $('#' + $(elemento.currentTarget).attr('id')).addClass('fa font-red-thunderbird');

                ultimoTipoAnexoIdTemporario = $(elemento.currentTarget).attr('data-tipo-anexo-id');

                $('#listDocumentoDeclaracao').show();
                elementoDocumentoDeclaracao =
                    "<li class='list-group-item row'>" +
                    "<a href='#' class='btn btn-link thumb' anexoId='" +
                    ultimoAnexoIdTemporario +
                    "'" +
                    "tipoAnexoId='" +
                    ultimoTipoAnexoIdTemporario +
                    "' >" +
                    verificarAnexoInserido(parseInt(ultimoTipoAnexoIdTemporario)) +
                    '' +
                    "</a><button anexoId='" +
                    ultimoAnexoIdTemporario +
                    "' tipoAnexoId='" +
                    ultimoTipoAnexoIdTemporario +
                    "'" +
                    "class='btn btn-danger btn-remover btn-xs'>Remover</button></li>";
                $('#ulDocumentoDeclaracao').append(elementoDocumentoDeclaracao);
                $('#ulDocumentoDeclaracao').show();

                var $inputUploadAnexo = $(
                    '#div-uploadArquivos [data-tipo-anexo-id=' + ultimoTipoAnexoIdTemporario + ']'
                );
                $inputUploadAnexo.hide();
                $inputUploadAnexo.siblings('p').hide();
                $inputUploadAnexo.siblings('.fa-check').show();

                $('#transicao-id-9').prop('disabled', false);
                $('#transicao-id-9').removeAttr('disabled').removeAttr('readonly');
                $('#transicao-id-9').attr('title', '');
            });

            Ecm.registraEvento('click', '.btn-remover', function (elemento) {
                excluirAnexo($(elemento.target).attr('anexoId'));
                elemento.target.closest('li').remove();
                if ($('#ulDocumentoDeclaracao')[0].childElementCount == 0) {
                    $('#ulDocumentoDeclaracao').hide();
                }

                var $inputUploadAnexo = $('#div-uploadArquivos .upload-file').filter(function () {
                    return $(this).attr('data-tipo-anexo-id') == $(elemento.target).attr('tipoAnexoId');
                });

                $inputUploadAnexo.val('');
                $inputUploadAnexo.show().removeClass('font-green-jungle');
                $inputUploadAnexo.closest('div').removeClass('fa-check font-green-jungle');
                $inputUploadAnexo.siblings('p').show();
                $inputUploadAnexo.siblings('.fa-check').hide();

                $('#transicao-id-9').prop('disabled', true);
                $('#transicao-id-9').attr('disabled', 'disabled').attr('readonly', 'readonly');
                $('#transicao-id-9').attr('title', 'Existem Pendências');
            });

            Ecm.registraEvento('keyup change', '#txtJustificativa', function () {
                validardocumentosAprovados();
            });

            function validaBotoes(id, status) {
                if(status) {
                    $(`a[id^='transicao-id-${id}']`).prop('disabled', false);
                    $(`a[id^='transicao-id-${id}']`).attr('readonly', false).attr('disabled', false);
                    $(`a[id^='transicao-id-${id}']`).attr('title', '');
                } else {
                    $(`a[id^='transicao-id-${id}']`).prop('disabled', true);
                    $(`a[id^='transicao-id-${id}']`).attr('readonly', true).attr('disabled', true);
                    $(`a[id^='transicao-id-${id}']`).attr('title', 'Existem pendências!');
                }
            }

            function validardocumentosAprovados() {
                var naoAprovados = 0;
                $('.documento-aprovado').each(function (i, elm) {
                    if ($(elm).val() != 'Sim') {
                        naoAprovados += 1;
                    }
                });

                if (naoAprovados == 0) {
                    $('#divJus').hide();

                    $('#transicao-id-9').prop('disabled', false);
                    $('#transicao-id-9').removeAttr('disabled').removeAttr('readonly');
                    $('#transicao-id-9').attr('title', '');


                    $('#txtJustificativa').removeAttr('required');
                } else {
                    $('#divJus').show();
                    $('#transicao-id-9').prop('disabled', true);
                    $('#transicao-id-9').attr('disabled', 'disabled').attr('readonly', 'readonly');
                    $('#transicao-id-9').attr('title', 'Existem Pendências');
                    $('#txtJustificativa').attr('required', 'required');

                    if (!$('#txtJustificativa').val()) {
                        $('#transicao-id-58').prop('disabled', true);
                        $('#transicao-id-58').attr('disabled', 'disabled').attr('readonly', 'readonly');
                        $('#transicao-id-58').attr('title', 'Existem Pendências');
                    } else {
                        $('#transicao-id-58').prop('disabled', false);
                        $('#transicao-id-58').removeAttr('disabled').removeAttr('readonly');
                        $('#transicao-id-58').attr('title', '');
                    }
                }
            }

            function excluirAnexo(anexoId) {
                var urlExcluirAnexo = `anexos/${anexoId}`;

                Ecm.Api2.Delete(urlExcluirAnexo)
                    .done(function () {
                        var documentoId = DocumentoVisualizacaoForm.documentoId(),
                            versaoId = DocumentoVisualizacaoForm.versaoId();

                        DocumentoVisualizacaoForm.carregarAnexosWs(documentoId, versaoId);
                    })
                    .fail(function (erro) {
                        console.log(erro);
                    });
            }

            function retornarAnexoDeclaracao(docVersaoId, tipoAnexoId, callback) {
                var urlRetornarAnexoPorTipoAnexo = `anexos/ultimoAnexoInserido/idVersaoDocumento/${docVersaoId}/idTipoAnexo/${tipoAnexoId}`;

                Ecm.Api2.Get(urlRetornarAnexoPorTipoAnexo)
                    .done(function (retorno) {
                        if (typeof callback === 'function') {
                            if (retorno.objeto) return callback(retorno.objeto);
                        }
                    })
                    .fail(function (erro) {
                        console.log(erro);
                    });
            }

            function retornarDeclaracao() {
                var listaCampos = DocumentoVisualizacaoForm.retornarCamposComValoresTela(),
                    itensAreaPesca = DocumentoVisualizacaoForm.retornaCampos().find(x => x.id == 28).valorComoArray,
                    itensProdutosPescaPretendidos = DocumentoVisualizacaoForm.retornaCampos().find(x => x.id == 27)
                        .valorComoArray,
                    areaPescaSelecionados = '',
                    produtosPescaPretendidosSelecionados = '';

                $.each(itensAreaPesca, function (indice, elemento) {
                    if (indice == itensAreaPesca.length - 1) {
                        areaPescaSelecionados = areaPescaSelecionados + elemento;
                    } else {
                        areaPescaSelecionados = areaPescaSelecionados + elemento + ' ' + '-' + ' ';
                    }
                });

                $.each(itensProdutosPescaPretendidos, function (indice, elemento) {
                    if (indice == itensProdutosPescaPretendidos.length - 1) {
                        produtosPescaPretendidosSelecionados = produtosPescaPretendidosSelecionados + elemento;
                    } else {
                        produtosPescaPretendidosSelecionados =
                            produtosPescaPretendidosSelecionados + elemento + ' ' + '-' + ' ';
                    }
                });

                listaCampos.push({
                    Id: '1010',
                    TipoDocumentalId: '2',
                    Nome: 'Área de pesca',
                    ColunaTipo: 'SPAN',
                    Valor: areaPescaSelecionados
                });

                listaCampos.push({
                    Id: '1011',
                    TipoDocumentalId: '2',
                    Nome: 'Produtos de Pesca Pretendidos',
                    ColunaTipo: 'SPAN',
                    Valor: produtosPescaPretendidosSelecionados
                });

                listaCampos.push({
                    Id: '1012',
                    TipoDocumentalId: '2',
                    Nome: 'Data Atual',
                    ColunaTipo: 'SPAN',
                    Valor: moment().format('DD/MM/YYYY')
                });

                $('#lbtDeclaracao').find('i').removeClass('fa-download').addClass('fa-spinner fa-spin');

                $('#lbtDeclaracao').attr('disabled', true);

                var parametros = JSON.stringify({
                    chave: 'DECLARACAO-RESPONSABILIDADE',
                    docVersaoId: $('.modal-body').data('versao-id'),
                    listaCampos: listaCampos,
                    tipoAnexoId: 56,
                    pdf: true,
                    excluirArquivoOrigem: false
                });

                Ecm.ajax(
                    '../WS/Ecm.asmx/AnexarTemplateCamposTela',
                    parametros,
                    function (data) {
                        var tipoAnexoId = 56;

                        $('#lbtDeclaracao').find('i').removeClass('fa-spinner fa-spin').addClass('fa-download');

                        $('#lbtDeclaracao').attr('disabled', false);

                        $('#lbtDeclaracao').find('i').removeClass('fa-spinner fa-spin').addClass('fa-download');

                        $('#lbtDeclaracao').attr('disabled', false);

                        data = JSON.parse(data);
                        $('a#linkDeclaracao').attr({
                            href: data.DiretorioArquivo
                        });

                        $('a#linkDeclaracao')[0].click();

                        retornarAnexoDeclaracao(docVersaoId, tipoAnexoId, function (anexoId) {
                            excluirAnexo(anexoId);
                        });
                    },
                    function () { }
                );
            }

            function retornarAnexo(anexoId, callback) {
                var urlRetornarAnexo = `anexo/${anexoId}/path`;

                Ecm.Api2.Get(urlRetornarAnexo)
                    .done(function (retorno) {
                        if (retorno) {
                            var xhr = new XMLHttpRequest();
                            xhr.open('GET', retorno.urlFile, true);
                            xhr.responseType = 'blob';
                            xhr.onload = function (e) {
                                var resp = this;
                                if (this.status == 200) {
                                    var urlCreator = window.URL || window.webkitURL;
                                    var imageUrl = urlCreator.createObjectURL(this.response);

                                    if (typeof callback === 'function') callback({ imageUrl: imageUrl });
                                }
                            };
                            xhr.send();
                        }
                    })
                    .fail(function (erro) {
                        console.log('Ocorreu um erro ao carregar o anexo.');
                        Ecm.desbloquearElemento('#views');
                        callback(erro);
                    });
            }
            Ecm.desbloquearElemento('.modal-body')
        });
    </script>
</body>

</html>